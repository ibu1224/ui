{{#if this.session.isAuthenticated}}
  {{#unless this.session.data.authenticated.isGuest}}
    {{pipeline-nav
      pipeline=this.pipeline
    }}
  {{/unless}}
{{/if}}


{{info-message message=this.errorMessage type="warning" icon="exclamation-triangle" scmContext=this.pipeline.scmContext}}

<div class="row">
  <div class="col-xs-12 col-md-9 separator partial-view">
    {{pipeline-graph-nav
      pipeline=this.pipeline
      mostRecent=this.mostRecent
      latestCommit=this.latestCommit
      lastSuccessful=this.lastSuccessful
      graphType=this.currentEventType
      selectedEvent=this.selectedEvent
      selectedEventObj=this.selectedEventObj
      selected=this.selected
      showListView=this.showListView
      showDownstreamTriggers=this.showDownstreamTriggers
      setDownstreamTrigger=(action "setDownstreamTrigger")
      startMainBuild=(action "startMainBuild")
      startPRBuild=(action "startPRBuild")
      prGroups=this.pullRequestGroups
      stopEvent=(action "stopEvent")
      setShowListView=(action "setShowListView")
    }}

    {{pipeline-workflow
      jobId=this.jobId
      pipeline=this.pipeline
      latestCommit=this.latestCommit
      showDownstreamTriggers=this.showDownstreamTriggers
      showPRJobs=this.showPRJobs
      completeWorkflowGraph=this.completeWorkflowGraph
      workflowGraph=this.pipeline.workflowGraph
      jobs=this.jobs
      selectedEventObj=this.selectedEventObj
      selected=this.selected
      startDetachedBuild=(action "startDetachedBuild")
      stopBuild=(action "stopBuild")
      authenticated=this.session.isAuthenticated
    }}

  </div>
  <div class="col-xs-12 col-md-3 no-padding column-tabs-view partial-view {{if this.showListView "disabled"}}" onScroll={{action "onEventListScroll"}}>
    <BsTab @customTabs={{true}} as |tab|>
      <BsNav @type="tabs" as |nav|>
        <nav.item @active={{bs-eq this.activeTab "events"}}>
          {{#nav.link-to "pipeline.events" class="nav-link"}}Events{{/nav.link-to}}
        </nav.item>
        <nav.item @active={{bs-eq this.activeTab "pulls"}}>
          {{#nav.link-to "pipeline.pulls" class="nav-link"}}Pull Requests{{/nav.link-to}}
        </nav.item>
      </BsNav>

      <div class="tab-content">
        <tab.pane @activeId={{this.activeTab}} @id="events" @title="Events">
          <PipelineEventsList
            @pipeline={{this.pipeline}}
            @expandedEventsGroup={{this.expandedEventsGroup}}
            @events={{this.events}}
            @selected={{fn (mut this.selected)}}
            @selectedEvent={{this.selectedEvent}}
            @latestCommit={{this.latestCommit}}
            @lastSuccessful={{this.lastSuccessful}}
            @mostRecent={{this.mostRecent}}
            @eventsPage={{this.eventsPage}}
            @startPRBuild={{this.startPRBuild}}
            @stopEvent={{this.stopEvent}}
            @updateEvents={{this.updateEvents}}
          />
          <div style="padding: 20px;" onMouseEnter={{action "onEventListScroll"}}></div>
        </tab.pane>
        <tab.pane @activeId={{this.activeTab}} @id="pulls" @title="Pull Requests">
          {{#if this.prChainEnabled}}
            <PipelineEventsList
            @pipeline={{this.pipeline}}
            @events={{this.events}}
            @expandedEventsGroup={{this.expandedEventsGroup}}
            @selected={{fn (mut this.selected)}}
            @selectedEvent={{this.selectedEvent}}
            @latestCommit={{this.latestCommit}}
            @lastSuccessful={{this.lastSuccessful}}
            @eventsPage={{this.eventsPage}}
            @startPRBuild={{this.startPRBuild}}
            @stopEvent={{this.stopEvent}}
            @updateEvents={{this.updateEvents}}
            />
          {{else}}
            {{#each this.pullRequestGroups as |prg|}}
              {{pipeline-pr-list
                jobs=prg
                pipeline=this.pipeline
                selected=(mut this.selected)
                selectedEvent=this.selectedEvent
                isRestricted=this.isRestricted
                startBuild=(action "startPRBuild")
                stopPRBuilds=(action "stopPRBuilds")
                workflowGraph=this.pipeline.workflowGraph
              }}
            {{else}}
              <div class="alert">No open pull requests</div>
            {{/each}}
          {{/if}}
        </tab.pane>
      </div>
    </BsTab>
  </div>
</div>

{{#if this.isShowingModal}}
  <ModalDialog @clickOutsideToClose={{false}} @targetAttachment="center" @translucentOverlay={{true}}>
    <LoadingView/>
  </ModalDialog>
{{/if}}

{{outlet}}
